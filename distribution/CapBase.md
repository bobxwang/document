#### CAP

> 如果发生分区,系统会牺牲什么,一致性还是可用性?
>
> * 如果分区,假设这个概率多大,哪些因素会造成分区?
> * 如果发生分区,一致性如何定义,应用需要什么样的一致性?
> * 如果发生分区,可用性如何定义,应用需要什么样的可用性?
> * 如果不发生分区,一致性和可用性又如何取舍?

#### 为啥说 CAP 不可能同时满足？

在分散式系统中，这三个特性至多只有两个能同时存在。 

- 假设有两台节点在不同机器上，如果存入资料的方式是 Two-phase commit，亦即所有节 点同意後才能存入资料，那麽只要 partition 发生丶或任何一个节点故障，就不能运作，因 此就只有 C 和 A。但这样的系统实在是太脆弱了，所以一般的分散式系统都会要求要有 P。
- 假设有两台节点在不同机器上，且必须要能容忍 Partition，那麽在 partition 发生时能怎麽 做呢？ 
  - Keep Availability：两个节点虽然彼此之间不能沟通，但是既然都活着，就让他们都 正常服务好了。这样其中一边的变化不能传递至另外一边，因此可能两边资料会不 一致。更糟的状况是发生裂脑，就两边都以为自己是 master 可以写入资料，就会产 生前两天提到的时序问题。(No consistency -- A 和 P) 
  - Keep Consistency: 为了避免之前提到的不一致问题，因此必须停掉其中任一个节点 (No availability -- C 和 P)

#### 两大原则

* 通过复制提高可用性

  * 主动复制

  * 被动复制 

    > 由一个服务器接收处理并更新其它服务器上的状态

#### P分解: 延迟? 故障? 分区?

> 故障检测,分区两侧是否能够在无通信的情况下继续操作。
>
> Partition Tolerance: 若一个集群因网络或节点故障，被切割成两个(或以上)不完成的 sub cluster时，系统整体还能正常运行。

* Fail-Fast , 通常用于非幂等性的写操作 
* Fail-Over, 备份操作模式,失败自动切换到从备
* Fail-Safe, 
* Fail-Back, 
* Forking, 
* Broadcast

#### C 一致性

> 分解不同业务场景和业务操作,使用合适的一致性模型

#### A 可用性

> 容错, 容错不是指系统能够在系统各种故障情况下还能工作,而是指系统在故障时能以明确的预订方式运行
>
> Availability: 若一个节点没有坏掉，那么它就必须要能正常服务。

#### Base 理论

- Basically Avaiable 基本可用 
- Soft state 
- Eventually consistent 最终一致性



